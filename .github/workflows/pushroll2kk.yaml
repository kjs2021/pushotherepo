name: kkpush example

on:
 workflow_dispatch:
  inputs:
      revision:
        description: 'The revision to rollback to'
        required: true
 push:
    branches:
     - main

     
env:
  Image_name: kamaljeet
  Image_version: 1.11.66
permissions: write-all
 

jobs:
# current-version:
#    - name: Get latest release 
#      uses: rez0n/actions-github-release@main
#      id: node_release
#       with:
#         token: ${{ secrets.GITHUB_TOKEN }}
#         repository: "kjs2021/maven"
#         type: "latest"
 Fail:
  runs-on: ubuntu-latest
  steps:
   - name: Invoke workflow in another repo with inputs
     id: fail
     run: ls

 trigger:
  runs-on: ubuntu-latest
  if:  ${{ success() }}
  needs: [Fail]
  permissions: write-all
  steps:
      - name: updated Imagename and Image version 
        run: |
         echo  "New Image will be  ${{ env.Image_name }}:${{ env.Image_version }}"
      - name: Repository Dispatch
        uses: peter-evans/repository-dispatch@v2.1.1
        with:
          token: ${{ secrets.ROLLPAT }}
          repository: kjs2021/maven
          event-type: kk
          client-payload: '{"img": "${{ env.Image_name }}","Image_version": "${{ env.Image_version }}"}'
 ROll:  
   runs-on: ubuntu-latest
   environment: rollback
   if:  ${{ failure() }}
   needs: [Fail]
   steps:
   - name: Invoke workflow in another repo with inputs
     id: trigger-step
     uses: aurelien-baudet/workflow-dispatch@v2
     with:
      workflow: kk Dispatch
      repo: kjs2021/maven
      ref: main
      token: ${{ secrets.ROLLPAT }}
      inputs: '{  "Roll-revision": "${{ vars.ROLLVERSION }}" }'
      wait-for-completion: true

   - name: Another step that can handle the result
     if: always()
     run: echo "Another Workflow conclusion:${{ steps.trigger-step.outputs.workflow-conclusion }}"
